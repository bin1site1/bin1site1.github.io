<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Apple Storeæ¯æ—¥é™å…Appæ±‡æ€»</title>
    <style>
        :root {
            --bg-color: #f5f7fa;
            --text-color: #333;
            --card-bg: #fff;
            --card-shadow: rgba(0, 0, 0, 0.07);
            --header-bg: #fff;
            --section-title-color: #1a73e8;
            --app-item-bg: #f9fafc;
            --app-item-hover: #f0f5ff;
            --footer-bg: #fff;
            --btn-primary: #1a73e8;
            --btn-primary-hover: #0d5bcd;
            --btn-secondary: #fbbc04;
            --btn-secondary-hover: #e6a700;
            --btn-tertiary: #4285f4;
            --btn-tertiary-hover: #3367d6;
            --btn-xhs: #ff2442;
            --btn-xhs-hover: #e01e3a;
            --btn-author: #673ab7;
            --btn-author-hover: #5e35b1;
            --btn-save: #34a853;
            --btn-save-hover: #2e8b47;
            --link-color: #1a73e8;
            --link-hover: #0d5bcd;
            --toast-bg: #34a853;
            --toast-error: #ea4335;
            --toast-warning: #fbbc05;
            --back-to-top-bg: #1a73e8;
            --back-to-top-hover: #0d5bcd;
            --ending-tag-bg: #e53935;
            --empty-tip-bg: #f9fafc;
            --help-section-bg: #f9fafc;
            --disclaimer-color: #e53935;
        }

        .dark-mode {
            --bg-color: #1a1a2e;
            --text-color: #e6e6e6;
            --card-bg: #16213e;
            --card-shadow: rgba(0, 0, 0, 0.3);
            --header-bg: #16213e;
            --section-title-color: #4cc9f0;
            --app-item-bg: #0f3460;
            --app-item-hover: #1a3a5f;
            --footer-bg: #16213e;
            --btn-primary: #4cc9f0;
            --btn-primary-hover: #2bb4e6;
            --btn-secondary: #f9c74f;
            --btn-secondary-hover: #f7b32b;
            --btn-tertiary: #5778ff;
            --btn-tertiary-hover: #3d5eff;
            --btn-xhs: #ff5c8d;
            --btn-xhs-hover: #ff3d7a;
            --btn-author: #9d4edd;
            --btn-author-hover: #8a2be2;
            --btn-save: #43aa8b;
            --btn-save-hover: #379683;
            --link-color: #4cc9f0;
            --link-hover: #2bb4e6;
            --toast-bg: #43aa8b;
            --toast-error: #f94144;
            --toast-warning: #f9c74f;
            --back-to-top-bg: #4cc9f0;
            --back-to-top-hover: #2bb4e6;
            --ending-tag-bg: #f94144;
            --empty-tip-bg: #0f3460;
            --help-section-bg: #0f3460;
            --disclaimer-color: #f94144;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: "Microsoft YaHei", "Roboto", sans-serif;
            transition: background-color 0.3s ease, color 0.3s ease, border-color 0.3s ease;
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            line-height: 1.6;
            padding: 20px;
        }

        /* æ¨¡å¼åˆ‡æ¢æŒ‰é’® */
        .theme-toggle {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1001;
            background: var(--card-bg);
            border: none;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            cursor: pointer;
            box-shadow: 0 2px 10px var(--card-shadow);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            color: var(--text-color);
        }

        .theme-toggle:hover {
            transform: scale(1.1);
        }

        /* æ°”æ³¡æç¤ºæ ·å¼ */
        .toast {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%) translateY(-100px);
            background-color: var(--toast-bg);
            color: white;
            padding: 12px 24px;
            border-radius: 25px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            z-index: 1000;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s ease;
            opacity: 0;
            white-space: nowrap;
        }

        .toast.show {
            transform: translateX(-50%) translateY(0);
            opacity: 1;
        }

        .toast.error {
            background-color: var(--toast-error);
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background-color: var(--header-bg);
            border-radius: 12px;
            box-shadow: 0 2px 10px var(--card-shadow);
        }

        .header h1 {
            color: var(--section-title-color);
            font-size: 24px;
            margin-bottom: 10px;
        }

        .update-info {
            color: var(--text-color);
            opacity: 0.8;
            font-size: 14px;
            margin-bottom: 15px;
        }

        .auto-update-tip {
            color: var(--section-title-color);
            font-size: 13px;
            font-weight: 500;
        }

        .btn-group {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 25px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            background-color: var(--btn-primary);
            color: #fff;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .btn:hover {
            background-color: var(--btn-primary-hover);
            transform: translateY(-2px);
        }

        .btn-secondary {
            background-color: var(--btn-secondary);
        }

        .btn-secondary:hover {
            background-color: var(--btn-secondary-hover);
        }

        .btn-tertiary {
            background-color: var(--btn-tertiary);
        }

        .btn-tertiary:hover {
            background-color: var(--btn-tertiary-hover);
        }

        .btn-xhs {
            background-color: var(--btn-xhs);
        }

        .btn-xhs:hover {
            background-color: var(--btn-xhs-hover);
        }

        .btn-author {
            background-color: var(--btn-author);
        }

        .btn-author:hover {
            background-color: var(--btn-author-hover);
        }

        .btn-save {
            background-color: var(--btn-save);
        }

        .btn-save:hover {
            background-color: var(--btn-save-hover);
        }

        .app-item.ending-soon {
            border-left: 4px solid var(--ending-tag-bg);
            background-color: rgba(229, 57, 53, 0.1);
        }

        .ending-tag {
            display: inline-block;
            padding: 2px 8px;
            background-color: var(--ending-tag-bg);
            color: #fff;
            font-size: 12px;
            border-radius: 4px;
            margin-left: 8px;
        }

        .back-to-top {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 45px;
            height: 45px;
            border-radius: 50%;
            background-color: var(--back-to-top-bg);
            color: #fff;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.2);
            transition: all 0.3s ease;
            opacity: 0;
            visibility: hidden;
            z-index: 90;
        }

        .back-to-top.active {
            opacity: 1;
            visibility: visible;
        }

        .back-to-top:hover {
            background-color: var(--back-to-top-hover);
            transform: translateY(-3px);
        }

        .main {
            display: flex;
            flex-wrap: wrap;
            gap: 25px;
            justify-content: center;
            margin-bottom: 30px;
        }

        .section-card {
            background-color: var(--card-bg);
            border-radius: 12px;
            box-shadow: 0 2px 15px var(--card-shadow);
            padding: 20px;
            width: 100%;
            max-width: 600px;
        }

        .section-title {
            color: var(--section-title-color);
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .app-list {
            margin-top: 15px;
        }

        .app-item {
            padding: 15px;
            border-radius: 8px;
            background-color: var(--app-item-bg);
            margin-bottom: 12px;
        }

        .app-item:hover {
            background-color: var(--app-item-hover);
        }

        .app-item:last-child {
            margin-bottom: 0;
        }

        .app-index {
            font-weight: 600;
            color: var(--section-title-color);
            margin-bottom: 5px;
            display: flex;
            align-items: center;
        }

        .app-info {
            font-size: 14px;
            color: var(--text-color);
        }

        .app-info p {
            margin-bottom: 5px;
        }

        .app-info .label {
            color: var(--text-color);
            opacity: 0.8;
            font-weight: 500;
            margin-right: 5px;
        }

        .app-url {
            color: var(--link-color);
            text-decoration: none;
            word-break: break-all;
        }

        .app-url:hover {
            text-decoration: underline;
            color: var(--link-hover);
        }

        .empty-tip {
            color: var(--text-color);
            opacity: 0.7;
            font-size: 14px;
            text-align: center;
            padding: 20px;
            background-color: var(--empty-tip-bg);
            border-radius: 8px;
        }

        .footer {
            background-color: var(--footer-bg);
            border-radius: 12px;
            box-shadow: 0 2px 10px var(--card-shadow);
            padding: 20px;
            font-size: 13px;
            color: var(--text-color);
            text-align: center;
            margin-top: 20px;
        }

        .footer-section {
            padding: 15px;
            border-radius: 8px;
            background-color: var(--help-section-bg);
            margin-bottom: 15px;
        }

        .footer-section:last-child {
            margin-bottom: 0;
        }

        .help-section .help-title {
            font-weight: 600;
            color: var(--section-title-color);
            margin-bottom: 8px;
            font-size: 14px;
        }

        .help-section .help-list {
            padding-left: 20px;
            line-height: 1.8;
            text-align: left;
        }

        .help-list li {
            margin-bottom: 6px;
        }

        .help-list li:last-child {
            margin-bottom: 0;
        }

        .disclaimer-section .disclaimer {
            font-weight: 500;
            color: var(--disclaimer-color);
            margin-bottom: 8px;
            font-size: 14px;
        }

        .loading,
        .error {
            text-align: center;
            padding: 30px;
            font-size: 16px;
            color: var(--text-color);
        }

        .error {
            color: var(--disclaimer-color);
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 20px;
            }

            .btn {
                padding: 8px 15px;
                font-size: 13px;
            }

            .btn span {
                display: none;
            }

            .btn i {
                font-size: 16px;
            }

            .section-card {
                padding: 15px;
            }

            .section-title {
                font-size: 16px;
            }

            .app-item {
                padding: 12px;
            }

            .app-info {
                font-size: 13px;
            }

            .back-to-top {
                bottom: 20px;
                right: 20px;
                width: 40px;
                height: 40px;
            }

            .help-list {
                padding-left: 15px;
                font-size: 12px;
            }

            .footer-section {
                padding: 12px;
            }

            .btn:hover {
                transform: none;
            }

            .toast {
                padding: 10px 20px;
                font-size: 13px;
            }

            .theme-toggle {
                top: 15px;
                right: 15px;
                width: 40px;
                height: 40px;
                font-size: 18px;
            }
        }
    </style>
</head>

<body>
    <!-- æ¨¡å¼åˆ‡æ¢æŒ‰é’® -->
    <button class="theme-toggle" id="theme-toggle" title="åˆ‡æ¢ç™½å¤©/é»‘å¤œæ¨¡å¼">
        <i class="fa fa-moon-o" id="theme-icon"></i>
    </button>

    <!-- æ°”æ³¡æç¤ºå®¹å™¨ -->
    <div id="toast" class="toast"></div>

    <div class="header" id="page-header">
        <h1>Apple Storeæ¯æ—¥é™å…Appæ±‡æ€»</h1>
        <div class="update-info">æœ€åæ›´æ–°ï¼š<span id="last-update">åŠ è½½ä¸­...</span></div>
        <div class="auto-update-tip">ğŸ”„ æ¯æ¬¡åˆ·æ–°é¡µé¢è‡ªåŠ¨è·å–æœ€æ–°é™å…æ•°æ®</div>
    </div>

    <div class="btn-group">
        <button class="btn" id="refresh-btn">
            <i class="fa fa-refresh"></i>
            <span>æ‰‹åŠ¨åˆ·æ–°æ•°æ®</span>
        </button>
        <button class="btn btn-secondary" id="copy-btn">
            <i class="fa fa-copy"></i>
            <span>ä¸€é”®å¤åˆ¶æ¸…å•</span>
        </button>
        <button class="btn btn-xhs" id="copy-xhs-btn">
            <i class="fa fa-file-text"></i>
            <span>ä¸€é”®å¤åˆ¶å°çº¢ä¹¦æ–‡æ¡ˆ</span>
        </button>
        <button class="btn btn-save" id="save-local-btn">
            <i class="fa fa-download"></i>
            <span>ä¸€é”®ä¿å­˜æœ¬åœ°</span>
        </button>
        <button class="btn btn-author" id="author-homepage-btn">
            <i class="fa fa-user"></i>
            <span>ä½œè€…ä¸»é¡µ</span>
        </button>
        <button class="btn btn-tertiary" id="share-btn">
            <i class="fa fa-share-alt"></i>
            <span>åˆ†äº«å½“å‰ç½‘é¡µ</span>
        </button>
    </div>

    <div class="main">
        <div class="section-card">
            <div class="section-title"><span>ğŸ“±</span>æœ¬ä½“é™å…App</div>
            <div id="app-free-container" class="app-list">
                <div class="loading">åŠ è½½ä¸­...æ­£åœ¨è·å–é™å…æ•°æ®</div>
            </div>
        </div>

        <div class="section-card">
            <div class="section-title"><span>ğŸ”“</span>å†…è´­é™å…App</div>
            <div id="in-app-free-container" class="app-list">
                <div class="loading">åŠ è½½ä¸­...æ­£åœ¨è·å–é™å…æ•°æ®</div>
            </div>
        </div>
    </div>

    <div class="footer">
        <div class="footer-section help-section">
            <div class="help-title">ğŸ“– ä½¿ç”¨å¸®åŠ©ï¼š</div>
            <ul class="help-list">
                <li>ç‚¹å‡»ã€Œæ‰‹åŠ¨åˆ·æ–°æ•°æ®ã€å¯ç«‹å³è·å–æœ€æ–°é™å…ä¿¡æ¯</li>
                <li>ã€Œä¸€é”®å¤åˆ¶æ¸…å•ã€å¯å°†æ‰€æœ‰é™å…ä¿¡æ¯å¤åˆ¶åˆ°å‰ªè´´æ¿</li>
                <li>ã€Œä¸€é”®å¤åˆ¶å°çº¢ä¹¦æ–‡æ¡ˆã€å¯å°†é™å…ä¿¡æ¯è½¬æ¢ä¸ºå°çº¢ä¹¦æ ¼å¼</li>
                <li>ã€Œä¸€é”®ä¿å­˜æœ¬åœ°ã€å¯å°†é™å…ä¿¡æ¯ä¿å­˜ä¸ºtxtæ–‡ä»¶åˆ°ç”µè„‘</li>
                <li>ã€Œä½œè€…ä¸»é¡µã€å¯è®¿é—®å¼€å‘è€…ä¸»é¡µè·å–æ›´å¤šèµ„æº</li>
                <li>ã€Œåˆ†äº«å½“å‰æ¸…å•ã€å¯é€šè¿‡ç¤¾äº¤è½¯ä»¶åˆ†äº«é™å…ä¿¡æ¯</li>
                <li>è‹¥å›½åŒºæ˜¾ç¤ºæ”¶è´¹ï¼Œå¯èƒ½æ˜¯å› ä¸ºè¯¥åº”ç”¨åœ¨ç¾åŒºæœ‰å…è´¹ç‰ˆæœ¬</li>
                <li>ç‚¹å‡»åº”ç”¨åœ°å€å¯ç›´æ¥è·³è½¬åˆ°App Storeä¸‹è½½</li>
            </ul>
        </div>

        <div class="footer-section disclaimer-section">
            <div class="disclaimer">âš ï¸ å…è´£å£°æ˜ï¼š</div>
            <div>æœ¬ä¿¡æ¯æ¥è‡ªç½‘ç»œï¼Œé™å…çŠ¶æ€å¯èƒ½å®æ—¶å˜åŒ–ï¼Œå®é™…æƒ…å†µä»¥App Storeä¸ºå‡†ã€‚</div>
        </div>
    </div>

    <div class="back-to-top" id="back-to-top">
        <i class="fa fa-chevron-up"></i>
    </div>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css">

    <script>
        const API_URL = "https://api.zxki.cn/api/appfree";

        // ä¸»é¢˜æ¨¡å¼åŠŸèƒ½
        function initThemeToggle() {
            const themeToggle = document.getElementById('theme-toggle');
            const themeIcon = document.getElementById('theme-icon');
            const prefersDarkScheme = window.matchMedia('(prefers-color-scheme: dark)');

            // æ£€æŸ¥æœ¬åœ°å­˜å‚¨çš„ä¸»é¢˜è®¾ç½®
            const savedTheme = localStorage.getItem('theme');

            // æ ¹æ®ä¿å­˜çš„è®¾ç½®æˆ–ç³»ç»Ÿåå¥½è®¾ç½®åˆå§‹ä¸»é¢˜
            if (savedTheme === 'dark' || (!savedTheme && prefersDarkScheme.matches)) {
                document.body.classList.add('dark-mode');
                themeIcon.className = 'fa fa-sun-o';
                themeToggle.title = 'åˆ‡æ¢åˆ°ç™½å¤©æ¨¡å¼';
            } else {
                document.body.classList.remove('dark-mode');
                themeIcon.className = 'fa fa-moon-o';
                themeToggle.title = 'åˆ‡æ¢åˆ°é»‘å¤œæ¨¡å¼';
            }

            // åˆ‡æ¢ä¸»é¢˜
            themeToggle.addEventListener('click', function () {
                if (document.body.classList.contains('dark-mode')) {
                    document.body.classList.remove('dark-mode');
                    localStorage.setItem('theme', 'light');
                    themeIcon.className = 'fa fa-moon-o';
                    themeToggle.title = 'åˆ‡æ¢åˆ°é»‘å¤œæ¨¡å¼';
                } else {
                    document.body.classList.add('dark-mode');
                    localStorage.setItem('theme', 'dark');
                    themeIcon.className = 'fa fa-sun-o';
                    themeToggle.title = 'åˆ‡æ¢åˆ°ç™½å¤©æ¨¡å¼';
                }
            });
        }

        // æ°”æ³¡æç¤ºå‡½æ•°
        function showToast(message, type = 'success') {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.className = 'toast';

            if (type === 'error') {
                toast.classList.add('error');
            } else if (type === 'warning') {
                toast.classList.add('warning');
            }

            toast.classList.add('show');

            setTimeout(() => {
                toast.classList.remove('show');
            }, 2000);
        }
        // è§£æåº”ç”¨æ•°æ®
        function parseAppData(appList) {
            return appList.map((app, index) => {
                let { name = '-----', desc = '-----', url = '-----', limitedTime = 'æœªçŸ¥' } = app;
                name = name.trim();
                desc = desc.trim();
                url = url.trim();
                limitedTime = limitedTime.trim() || 'æœªçŸ¥';

                if ((desc === '-----' || desc === '' || desc === ' ') && name.includes('//')) {
                    const splitResult = name.split('//', 2);
                    name = splitResult[0].trim();
                    desc = splitResult.length > 1 ? splitResult[1].trim() : '';
                }

                if (desc === '' || desc === ' ' || desc === '-----') {
                    desc = 'æœªçŸ¥';
                }

                desc = desc.replace('https', '').replace('http', '');
                const isEndingSoon = limitedTime.includes('24å°æ—¶å†…') || limitedTime.includes('12å°æ—¶å†…') || limitedTime.includes('6å°æ—¶å†…');

                return {
                    index: index + 1,
                    name,
                    desc,
                    url,
                    limitedTime,
                    isEndingSoon
                };
            });
        }
        // æ¸²æŸ“åº”ç”¨åˆ—è¡¨åˆ°æŒ‡å®šå®¹å™¨
        function renderAppList(containerId, appList) {
            const container = document.getElementById(containerId);
            container.innerHTML = '';

            if (appList.length === 0) {
                container.innerHTML = '<div class="empty-tip">æš‚æ— ç¬¦åˆæ¡ä»¶çš„é™å…æ•°æ®</div>';
                return;
            }

            appList.forEach(app => {
                const appItem = document.createElement('div');
                appItem.className = `app-item ${app.isEndingSoon ? 'ending-soon' : ''}`;

                appItem.innerHTML = `
                    <div class="app-index">
                        ${app.index}. åç§°ï¼š${app.name}
                        ${app.isEndingSoon ? '<span class="ending-tag">å³å°†ç»“æŸ</span>' : ''}
                    </div>
                    <div class="app-info">
                        <p><span class="label">ç®€ä»‹ï¼š</span>${app.desc === '---' ? 'æœªçŸ¥' : app.desc}</p>
                        <p><span class="label">åœ°å€ï¼š</span><a href="${app.url}" target="_blank" class="app-url">${app.url}</a></p>
                    </div>
                `;

                container.appendChild(appItem);
            });
        }
        // è·å–å¹¶å±•ç¤ºé™å…åº”ç”¨æ•°æ®
        async function fetchAndShowAppData() {
            const loadingHtml = '<div class="loading">åŠ è½½ä¸­...æ­£åœ¨è·å–é™å…æ•°æ®</div>';
            document.getElementById('app-free-container').innerHTML = loadingHtml;
            document.getElementById('in-app-free-container').innerHTML = loadingHtml;

            try {
                const response = await fetch(API_URL, {
                    method: 'GET',
                    headers: {
                        'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/128.0.0.0 Safari/537.36',
                        'Accept': 'application/json, text/plain, */*',
                        'Referer': 'https://example.com'
                    }
                });

                if (!response.ok) {
                    throw new Error(`è¯·æ±‚å¤±è´¥ï¼ˆçŠ¶æ€ç ï¼š${response.status}ï¼‰ï¼Œå¯èƒ½APIæš‚æ—¶ä¸å¯ç”¨`);
                }

                const appData = await response.json();

                if (!appData || typeof appData !== 'object' || !('apps' in appData)) {
                    throw new Error('APIè¿”å›æ•°æ®æ ¼å¼å¼‚å¸¸ï¼Œç¼ºå°‘"apps"æ ¸å¿ƒå­—æ®µ');
                }
                if (typeof appData.apps !== 'object' || !('æœ¬ä½“é™å…' in appData.apps) || !('å†…è´­é™å…' in appData.apps)) {
                    throw new Error('APIè¿”å›çš„"apps"å­—æ®µæ ¼å¼é”™è¯¯ï¼Œéœ€åŒ…å«"æœ¬ä½“é™å…"å’Œ"å†…è´­é™å…"');
                }

                const appFreeList = parseAppData(Array.isArray(appData.apps['æœ¬ä½“é™å…']) ? appData.apps['æœ¬ä½“é™å…'] : []);
                const inAppFreeList = parseAppData(Array.isArray(appData.apps['å†…è´­é™å…']) ? appData.apps['å†…è´­é™å…'] : []);

                const lastUpdated = appData.last_updated || new Date().toLocaleString();

                renderAppList('app-free-container', appFreeList);
                renderAppList('in-app-free-container', inAppFreeList);
                document.getElementById('last-update').textContent = lastUpdated;

            } catch (error) {
                const errorHtml = `<div class="error">âŒ æ•°æ®è·å–å¤±è´¥ï¼š${error.message}</div>`;
                document.getElementById('app-free-container').innerHTML = errorHtml;
                document.getElementById('in-app-free-container').innerHTML = errorHtml;
                console.error('APIè¯·æ±‚é”™è¯¯è¯¦æƒ…ï¼š', error);
            }
        }
        // å¤åˆ¶åˆ°å‰ªè´´æ¿
        function copyToClipboard() {
            const lastUpdateTime = document.getElementById('last-update').textContent;
            let content = `ğŸ Apple Storeæ¯æ—¥é™å…åº”ç”¨æ±‡æ€»\n\næœ€åæ›´æ–°ï¼š${lastUpdateTime}\n\n`;

            const appFreeItems = document.querySelectorAll('#app-free-container .app-item');
            const inAppFreeItems = document.querySelectorAll('#in-app-free-container .app-item');
            // æœ¬ä½“é™å…App
            content += "ğŸ“± æœ¬ä½“é™å…Appï¼š\n\n";
            if (appFreeItems.length === 0) {
                content += "   æš‚æ— æœ¬ä½“é™å…Appæ•°æ®\n\n";
            } else {
                appFreeItems.forEach((item, appIndex) => {
                    const nameElem = item.querySelector('.app-index');
                    const nameText = nameElem ? nameElem.textContent.replace(/å³å°†ç»“æŸ/, '').trim() : 'æœªçŸ¥åç§°';
                    const name = nameText.split('åç§°ï¼š')[1] || 'æœªçŸ¥åç§°';

                    let desc = 'æ— ç®€ä»‹';
                    const infoPs = item.querySelectorAll('.app-info p');
                    infoPs.forEach(p => {
                        if (p.textContent.includes('ç®€ä»‹ï¼š')) {
                            desc = p.textContent.split('ç®€ä»‹ï¼š')[1] || 'æ— ç®€ä»‹'; if(desc === '---') desc = 'æœªçŸ¥'; if(desc === '---') desc = 'æœªçŸ¥'; if(desc === '---') desc = 'æœªçŸ¥';
                        }
                    });

                    const urlElem = item.querySelector('.app-url');
                    const url = urlElem ? urlElem.textContent : 'æ— åœ°å€';

                    content += `${appIndex + 1}. åç§°ï¼š${name}\n`;
                    content += `   ç®€ä»‹ï¼š${desc}\n`;
                    content += `   åœ°å€ï¼š${url}\n\n`;
                });
            }
            // å†…è´­é™å…App
            content += "ğŸ”“ å†…è´­é™å…Appï¼š\n\n";
            if (inAppFreeItems.length === 0) {
                content += "   æš‚æ— å†…è´­é™å…Appæ•°æ®\n\n";
            } else {
                inAppFreeItems.forEach((item, appIndex) => {
                    const nameElem = item.querySelector('.app-index');
                    const nameText = nameElem ? nameElem.textContent.replace(/å³å°†ç»“æŸ/, '').trim() : 'æœªçŸ¥åç§°';
                    const name = nameText.split('åç§°ï¼š')[1] || 'æœªçŸ¥åç§°';

                    let desc = 'æ— ç®€ä»‹';
                    const infoPs = item.querySelectorAll('.app-info p');
                    infoPs.forEach(p => {
                        if (p.textContent.includes('ç®€ä»‹ï¼š')) {
                            desc = p.textContent.split('ç®€ä»‹ï¼š')[1] || 'æ— ç®€ä»‹'; if(desc === '---') desc = 'æœªçŸ¥';
                        }
                    });

                    const urlElem = item.querySelector('.app-url');
                    const url = urlElem ? urlElem.textContent : 'æ— åœ°å€';

                    content += `${appIndex + 1}. åç§°ï¼š${name}\n`;
                    content += `   ç®€ä»‹ï¼š${desc}\n`;
                    content += `   åœ°å€ï¼š${url}\n\n`;
                });
            }

            content += "âš ï¸  å…è´£å£°æ˜ï¼š\n";
            content += "æœ¬ä¿¡æ¯æ¥è‡ªç½‘ç»œï¼Œé™å…çŠ¶æ€å¯èƒ½å®æ—¶å˜åŒ–ï¼Œå®é™…æƒ…å†µä»¥App Storeä¸ºå‡†ã€‚";

            if (navigator.clipboard && window.isSecureContext) {
                navigator.clipboard.writeText(content)
                    .then(() => showToast('âœ… æ¸…å•å·²æˆåŠŸå¤åˆ¶åˆ°å‰ªè´´æ¿ï¼'))
                    .catch(err => {
                        console.error('Clipboard APIå¤±è´¥ï¼š', err);
                        fallbackCopy(content);
                    });
            } else {
                fallbackCopy(content);
            }
        }
        /// å¤åˆ¶åˆ°å°çº¢ä¹¦
        function copyToXiaohongshu() {
            const lastUpdateTime = document.getElementById('last-update').textContent;
            let content = `ğŸ è‹¹æœå•†åº—é™å…APPæ±‡æ€»\n\næœ€åæ›´æ–°ï¼š${lastUpdateTime}\n\n`;
            // æœ¬ä½“é™å…App
            const appFreeItems = document.querySelectorAll('#app-free-container .app-item');
            if (appFreeItems.length > 0) {
                content += "ğŸ“±æœ¬ä½“é™å…APP\n\n";
                appFreeItems.forEach((item, appIndex) => {
                    const nameElem = item.querySelector('.app-index');
                    const nameText = nameElem ? nameElem.textContent.replace(/å³å°†ç»“æŸ/, '').trim() : 'æœªçŸ¥åç§°';
                    const name = nameText.split('åç§°ï¼š')[1] || 'æœªçŸ¥åç§°';

                    let desc = 'æ— ç®€ä»‹';
                    const infoPs = item.querySelectorAll('.app-info p');
                    infoPs.forEach(p => {
                        if (p.textContent.includes('ç®€ä»‹ï¼š')) {
                            desc = p.textContent.split('ç®€ä»‹ï¼š')[1] || 'æ— ç®€ä»‹'; if(desc === '---') desc = 'æœªçŸ¥';
                        }
                    });

                    content += `${appIndex + 1}ã€${name}  //  ${desc}\n`;
                });
                content += "\n";
            }
            // å†…è´­é™å…App
            const inAppFreeItems = document.querySelectorAll('#in-app-free-container .app-item');
            if (inAppFreeItems.length > 0) {
                content += "ğŸ”“ å†…è´­é™å…APP\n\n";
                inAppFreeItems.forEach((item, appIndex) => {
                    const nameElem = item.querySelector('.app-index');
                    const nameText = nameElem ? nameElem.textContent.replace(/å³å°†ç»“æŸ/, '').trim() : 'æœªçŸ¥åç§°';
                    const name = nameText.split('åç§°ï¼š')[1] || 'æœªçŸ¥åç§°';

                    let desc = 'æ— ç®€ä»‹';
                    const infoPs = item.querySelectorAll('.app-info p');
                    infoPs.forEach(p => {
                        if (p.textContent.includes('ç®€ä»‹ï¼š')) {
                            desc = p.textContent.split('ç®€ä»‹ï¼š')[1] || 'æ— ç®€ä»‹'; if(desc === '---') desc = 'æœªçŸ¥';
                        }
                    });

                    content += `${appIndex + 1}ã€${name}  //  ${desc}\n`;
                });
                content += "\n";
            }

            content += "âš ï¸ å…è´£å£°æ˜ï¼š\n";
            content += "æœ¬ä¿¡æ¯æ¥è‡ªç½‘ç»œï¼Œé™å…çŠ¶æ€å¯èƒ½å®æ—¶å˜åŒ–ï¼Œä»¥App Storeä¸ºå‡†ã€‚\n\n";
            content += " ğŸ”å‹æƒ…æç¤º: \n";
            content += " 1ã€applestoreæœç´¢appåç§°æŸ¥çœ‹è¯¦æƒ…ï¼Œè‹¥å›½åŒºæ”¶è´¹åˆ™å¯å°è¯•åˆ‡æ¢è‡³ipç¾åŒºï¼›\n";
            content += " 2ã€æ´»åŠ¨æœ‰æ—¶æ•ˆæ€§ï¼Œè‹¥ä¸æ˜¾ç¤ºfreeåˆ™è¡¨ç¤ºå·²ç»“æŸï¼Œå¯ç­‰å¾…ä¸‹æ¬¡æ´»åŠ¨å¼€å¯ã€‚";

            if (navigator.clipboard && window.isSecureContext) {
                navigator.clipboard.writeText(content)
                    .then(() => showToast('âœ… å°çº¢ä¹¦æ–‡æ¡ˆå·²æˆåŠŸå¤åˆ¶åˆ°å‰ªè´´æ¿ï¼'))
                    .catch(err => {
                        console.error('Clipboard APIå¤±è´¥ï¼š', err);
                        fallbackCopy(content);
                    });
            } else {
                fallbackCopy(content);
            }
        }
        // å›é€€å¤åˆ¶å‡½æ•°
        function fallbackCopy(content) {
            const textarea = document.createElement('textarea');
            textarea.value = content;
            textarea.style.position = 'fixed';
            textarea.style.top = '-999px';
            textarea.style.left = '-999px';
            document.body.appendChild(textarea);

            textarea.select();
            textarea.setSelectionRange(0, content.length);
            const success = document.execCommand('copy');

            document.body.removeChild(textarea);

            if (success) {
                showToast('âœ… å†…å®¹å·²æˆåŠŸå¤åˆ¶åˆ°å‰ªè´´æ¿ï¼');
            } else {
                showToast('âŒ å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶é¡µé¢å†…å®¹', 'error');
            }
        }
        // åˆå§‹åŒ–ä½œè€…ä¸»é¡µåŠŸèƒ½
        function initAuthorHomepageFeature() {
            const authorBtn = document.getElementById('author-homepage-btn');

            authorBtn.addEventListener('click', function () {
                const authorHomepageUrl = 'https://bin1site1.github.io';
                window.open(authorHomepageUrl, '_blank');
            });
        }
        // åˆå§‹åŒ–ä¿å­˜åˆ°æœ¬åœ°åŠŸèƒ½
        function initSaveToLocalFeature() {
            const saveBtn = document.getElementById('save-local-btn');

            saveBtn.addEventListener('click', function () {
                const now = new Date();
                const dateStr = now.toISOString().split('T')[0];
                const timeStr = now.toTimeString().split(' ')[0].replace(/:/g, '-');

                const fileName = `AppleStoreé™å…æ±‡æ€»_${dateStr}_${timeStr}.txt`;

                const lastUpdateTime = document.getElementById('last-update').textContent;
                let content = `ğŸ Apple Storeæ¯æ—¥é™å…åº”ç”¨æ±‡æ€»\n\næœ€åæ›´æ–°ï¼š${lastUpdateTime}\n\n`;

                const appFreeItems = document.querySelectorAll('#app-free-container .app-item');
                const inAppFreeItems = document.querySelectorAll('#in-app-free-container .app-item');
                // æœ¬ä½“é™å…App
                content += "ğŸ“± æœ¬ä½“é™å…Appï¼š\n\n";
                if (appFreeItems.length === 0) {
                    content += "   æš‚æ— æœ¬ä½“é™å…Appæ•°æ®\n\n";
                } else {
                    appFreeItems.forEach((item, appIndex) => {
                        const nameElem = item.querySelector('.app-index');
                        const nameText = nameElem ? nameElem.textContent.replace(/å³å°†ç»“æŸ/, '').trim() : 'æœªçŸ¥åç§°';
                        const name = nameText.split('åç§°ï¼š')[1] || 'æœªçŸ¥åç§°';

                        let desc = 'æ— ç®€ä»‹';
                        const infoPs = item.querySelectorAll('.app-info p');
                        infoPs.forEach(p => {
                            if (p.textContent.includes('ç®€ä»‹ï¼š')) {
                                desc = p.textContent.split('ç®€ä»‹ï¼š')[1] || 'æ— ç®€ä»‹'; if(desc === '---') desc = 'æœªçŸ¥';
                            }
                        });

                        const urlElem = item.querySelector('.app-url');
                        const url = urlElem ? urlElem.textContent : 'æ— åœ°å€';

                        content += `${appIndex + 1}. åç§°ï¼š${name}\n`;
                        content += `   ç®€ä»‹ï¼š${desc}\n`;
                        content += `   åœ°å€ï¼š${url}\n\n`;
                    });
                }
                // å†…è´­é™å…App
                content += "ğŸ”“ å†…è´­é™å…Appï¼š\n\n";
                if (inAppFreeItems.length === 0) {
                    content += "   æš‚æ— å†…è´­é™å…Appæ•°æ®\n\n";
                } else {
                    inAppFreeItems.forEach((item, appIndex) => {
                        const nameElem = item.querySelector('.app-index');
                        const nameText = nameElem ? nameElem.textContent.replace(/å³å°†ç»“æŸ/, '').trim() : 'æœªçŸ¥åç§°';
                        const name = nameText.split('åç§°ï¼š')[1] || 'æœªçŸ¥åç§°';

                        let desc = 'æ— ç®€ä»‹';
                        const infoPs = item.querySelectorAll('.app-info p');
                        infoPs.forEach(p => {
                            if (p.textContent.includes('ç®€ä»‹ï¼š')) {
                                desc = p.textContent.split('ç®€ä»‹ï¼š')[1] || 'æ— ç®€ä»‹'; if(desc === '---') desc = 'æœªçŸ¥';
                            }
                        });

                        const urlElem = item.querySelector('.app-url');
                        const url = urlElem ? urlElem.textContent : 'æ— åœ°å€';

                        content += `${appIndex + 1}. åç§°ï¼š${name}\n`;
                        content += `   ç®€ä»‹ï¼š${desc}\n`;
                        content += `   åœ°å€ï¼š${url}\n\n`;
                    });
                }

                content += "âš ï¸  å…è´£å£°æ˜ï¼š\n";
                content += "æœ¬ä¿¡æ¯æ¥è‡ªç½‘ç»œï¼Œé™å…çŠ¶æ€å¯èƒ½å®æ—¶å˜åŒ–ï¼Œå®é™…æƒ…å†µä»¥App Storeä¸ºå‡†ã€‚\n\n";
                content += "ç”Ÿæˆæ—¶é—´ï¼š" + now.toLocaleString('zh-CN');

                const blob = new Blob([content], { type: 'text/plain;charset=utf-8' });
                const url = URL.createObjectURL(blob);

                const a = document.createElement('a');
                a.href = url;
                a.download = fileName;
                document.body.appendChild(a);
                a.click();

                setTimeout(() => {
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);
                }, 100);

                showToast('âœ… é™å…æ•°æ®å·²æˆåŠŸä¿å­˜ä¸ºæ–‡ä»¶ï¼š' + fileName);
            });
        }
        // åˆå§‹åŒ–åˆ†äº«åŠŸèƒ½
        function initShareFeature() {
            const shareBtn = document.getElementById('share-btn');

            shareBtn.addEventListener('click', async () => {
                const lastUpdateTime = document.getElementById('last-update').textContent;
                const shareTitle = `Apple Storeé™å…æ±‡æ€»ï¼ˆ${lastUpdateTime}æ›´æ–°ï¼‰`;
                const shareText = `å‘ç°ä¸€æ‰¹Apple Storeé™å…åº”ç”¨ï¼ŒåŒ…å«æœ¬ä½“é™å…å’Œå†…è´­é™å…ï¼Œé€Ÿé¢†ï¼`;
                const shareUrl = window.location.href;

                try {
                    await navigator.share({
                        title: shareTitle,
                        text: shareText,
                        url: shareUrl
                    });
                } catch (err) {
                    console.log('Web Share APIä¸æ”¯æŒï¼Œåˆ‡æ¢ä¸ºå¤åˆ¶é“¾æ¥', err);
                    await navigator.clipboard.writeText(`${shareTitle}\n${shareText}\né“¾æ¥ï¼š${shareUrl}`);
                    showToast('âœ… åˆ†äº«å†…å®¹å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼Œå¯æ‰‹åŠ¨ç²˜è´´åˆ†äº«ï¼');
                }
            });
        }
        // åˆå§‹åŒ–è¿”å›é¡¶éƒ¨åŠŸèƒ½
        function initBackToTopFeature() {
            const backToTopBtn = document.getElementById('back-to-top');
            const pageHeader = document.getElementById('page-header');

            window.addEventListener('scroll', () => {
                if (window.scrollY > 300) {
                    backToTopBtn.classList.add('active');
                } else {
                    backToTopBtn.classList.remove('active');
                }
            });

            backToTopBtn.addEventListener('click', () => {
                pageHeader.scrollIntoView({ behavior: 'smooth' });
            });
        }
        // åˆå§‹åŒ–ä¸»é¢˜åˆ‡æ¢åŠŸèƒ½
        document.addEventListener('DOMContentLoaded', () => {
            initThemeToggle();
            fetchAndShowAppData();

            document.getElementById('refresh-btn').addEventListener('click', fetchAndShowAppData);
            document.getElementById('copy-btn').addEventListener('click', copyToClipboard);
            document.getElementById('copy-xhs-btn').addEventListener('click', copyToXiaohongshu);

            initAuthorHomepageFeature();
            initSaveToLocalFeature();
            initShareFeature();
            initBackToTopFeature();
        });
    </script>
</body>

</html>